(function($,moment){var defaults={items:[],startDate:moment().format("YYYY-MM-DD"),countShowDay:10,roomStateColorClass:{busy:"success",reservation:"part-payed",partPayed:"warning",free:""},headConfig:{buttonNextPrev:true,headerTitle:"Room calendar"},sourceConfig:{actionUrl:"",dataType:"JSON"},locationFilter:{enable:false,actionUrl:"",dataType:"JSON",items:[]},roomTypeColor:{male:"info",female:"danger"},rangeFilter:{enable:true,datetimePlugin:true},loaderImg:"/bundles/vtereshenkovreservation/images/ajax-loader.gif"};var RC={options:{},items:[],rangeDates:[],container:{},filters:{location:null,range:{start:"",end:""}},lastTitleRoom:"",allLocation:false,multipleSelectionElement:{},selectingNewRangeOn:false,rangesForNewOrder:[],initCalendar:function(calendarContainer,options){var items=options.items,startDate=options.startDate,countShowDay=options.countShowDay,rangeDates=this.getRangeDate(startDate,countShowDay),me=this;me.container=calendarContainer;me.rangeDates=rangeDates;me.items=items;me.container.append('<div class="rc-wrapper"></div>');me.container=me.container.find(".rc-wrapper");if(true===me.options.locationFilter.enable){for(var i=0;i<me.options.locationFilter.items.length;i++){if(true===me.options.locationFilter.items[i].selected){me.filters.location=me.options.locationFilter.items[i].id;break}}}if(me.options.sourceConfig.actionUrl===""){me.renderCalendarTable()}else{me.getSourceData("init")}},renderCalendarTable:function(){var me=this,items=me.items,rangeDates=me.rangeDates,calendarContainer=me.container;var tableRoom="";if(true===me.options.headConfig.buttonNextPrev||true===me.options.locationFilter.enable){tableRoom+='<div class="rc-toolbar">'+'<div class="row">'+'<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">'+(true===me.options.locationFilter.enable?'<select id="rc-select-location" class="form-control">'+(me.options.locationFilter.items.length>0?me.createSelectOption(me.options.locationFilter.items):"<option>Select location</option>")+"</select>":"")+"</div>"+'<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><h2 class="rc-toolbar-header">'+me.options.headConfig.headerTitle+"</h2>"+(true===me.options.rangeFilter.enable?me.getRangeFilterBlock():"")+"</div>"+'<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">'+(true===me.options.headConfig.buttonNextPrev?'<div class="rc-range-button-block pull-right">'+'<button class="btn btn-default" id="rc-prev-range-date">prev</button>'+'<button class="btn btn-default" id="rc-next-range-date">next</button>':"")+"</div>"+"</div>"+"</div>"+"</div>"}tableRoom+='<div class="rc-view-container"><table class="rc-table table">'+"<thead>"+'<tr class="rc-calendar-header">'+'<th colspan="2"><div class="rc-header-cell">Room/bad</div></th>'+this.renderHeaderDateColumn(rangeDates)+"</tr>"+"</thead>"+'<tbody class="rc-calendar-body">'+this.renderRooms(items,rangeDates)+"</tbody>"+"</table></div>";tableRoom+='<div class="navbar navbar-fixed-bottom rc-bottom-toolbar" style="display:none;">'+'<div class="rc-confirm-block">'+'<button class="btn btn-success" id="rc_confirm_ok">Ok</button>'+'<button class="btn btn-danger" id="rc_confirm_cancel">Cancel</button>'+"</div>"+"</div>";calendarContainer.append(tableRoom);var cellRooms=calendarContainer.find(".rc-table tbody > tr > td.rc-body-room-td"),toolbar=calendarContainer.find(".rc-bottom-toolbar .rc-confirm-block");me.setEventCellRoms(cellRooms,items,toolbar);if(true===me.options.headConfig.buttonNextPrev){$("#rc-prev-range-date").on("click.roomCalendar",function(){me.newDateRange("prev")});$("#rc-next-range-date").on("click.roomCalendar",function(){me.newDateRange("next")})}if(true===me.options.locationFilter.enable){$("#rc-select-location").on("change.roomCalendar",function(){var idSelect=this.value;me.filters.location=idSelect;me.applyLocationFilter()})}if(true===me.options.rangeFilter.enable){$("#rc-range-filter-start").val(rangeDates[0]);$("#rc-range-filter-end").val(rangeDates[rangeDates.length-1]);$("#rc-range-filter-submit").on("click.roomCalendar",function(){var start=$("#rc-range-filter-start").val(),end=$("#rc-range-filter-end").val();me.filters.range={start:start,end:end};me.applyRangeFilter()});if(true===me.options.rangeFilter.datetimePlugin){$("#rc-range-filter-start").datetimepicker({pickTime:false,language:"en",format:"YYYY-MM-DD"});$("#rc-range-filter-end").datetimepicker({pickTime:false,language:"en",format:"YYYY-MM-DD"})}}},renderCalendarItems:function(){var me=this;if(me.rangeDates.length<=0){me.filters.range={start:$("#rc-range-filter-start").val(),end:$("#rc-range-filter-end").val()}}else{me.filters.range={start:me.rangeDates[0],end:me.rangeDates[me.rangeDates.length-1]}}me.applyRangeFilter()},setEventCellRoms:function(cellRooms,items,toolbar){var me=this,calendarContainer=me.container,toolbarBox=toolbar.parent(".rc-bottom-toolbar");cellRooms.on("click.roomCalendarCell",function(){var roomNumberEl=$(this).find("div.rc-body-cell"),roomCellDate=roomNumberEl.data("date"),roomCellNumber=roomNumberEl.data("room"),roomFree=roomNumberEl.hasClass("free-room-day"),locationRow=$(this).parent("tr").data("location");var roomCellData={roomData:{roomFree:roomFree},cellDate:"",cellData:{}};if(roomCellNumber!==""){if(locationRow===undefined||locationRow===""||locationRow===null){locationRow=""}var rowRoomBedData=me.findRoomData(roomCellNumber,items,locationRow);if(false===roomFree){var dataFind=false,busyDate=rowRoomBedData.roomData.busy,reservationDate=rowRoomBedData.roomData.reservation,partPayedDate=rowRoomBedData.roomData.part_payed;if(busyDate.range.length>0){var isBusy=false;isBusy=me.findReservationDayRangeData(roomCellDate,busyDate.range);if(true===isBusy.found){roomCellData.cellData=isBusy.order;roomCellData.cellData.client=isBusy.client;roomCellData.cellData.check_in=isBusy.check_in;roomCellData.cellData.check_out=isBusy.check_out;dataFind=true}}if(reservationDate.range.length>0&&false===dataFind){var isReservation=false;isReservation=me.findReservationDayRangeData(roomCellDate,reservationDate.range);if(true===isReservation.found){roomCellData.cellData=isReservation.order;roomCellData.cellData.client=isReservation.client;roomCellData.cellData.check_in=isReservation.check_in;roomCellData.cellData.check_out=isReservation.check_out;dataFind=true}}if(partPayedDate.range.length>0&&false===dataFind){var isPartPayedDate=false;isPartPayedDate=me.findReservationDayRangeData(roomCellDate,partPayedDate.range);if(true===isPartPayedDate.found){roomCellData.cellData=isPartPayedDate.order;roomCellData.cellData.client=isPartPayedDate.client;roomCellData.cellData.check_in=isPartPayedDate.check_in;roomCellData.cellData.check_out=isPartPayedDate.check_out;dataFind=true}}}roomCellData.roomData=me.findRoomData(roomCellNumber,items);roomCellData.roomData.roomFree=roomFree;roomCellData.cellDate=roomCellDate}else{roomCellData.cellDate=roomCellDate}calendarContainer.trigger($.Event("rc-roomclick"),roomCellData)});cellRooms.on("mousedown.roomCalendarCell",function(){var wrapperEl=$(this),roomNumberEl=wrapperEl.find("div.rc-body-cell"),roomCellDate=roomNumberEl.data("date"),roomCellBed=roomNumberEl.data("room"),parentRow=$(this).parent("tr"),bedPricePerDay=0,bedPricePerMonth=0,bedId=null,roomId=null;if(roomNumberEl.hasClass("free-room-day")&&!wrapperEl.hasClass("hover-calendar-cell")){bedPricePerDay=parseInt(roomNumberEl.data("bed-price-per-day"));bedPricePerMonth=parseInt(roomNumberEl.data("bed-price-per-month"));bedId=parseInt(roomNumberEl.data("bed-id"));roomId=parseInt(roomNumberEl.data("bed-room-id"));me.multipleSelectionElement={};me.multipleSelectionElement={date:roomCellDate,roomBed:roomCellBed,parentRow:parentRow,dateRange:[roomCellDate],bedPricePerDay:bedPricePerDay,bedPricePerMonth:bedPricePerMonth,bedId:bedId,roomId:roomId};me.selectingNewRangeOn=true;$(this).addClass("hover-calendar-cell-temp");toolbarBox.show()}else if(!wrapperEl.hasClass(me.options.roomStateColorClass.busy)&&!wrapperEl.hasClass(me.options.roomStateColorClass.partPayed)&&!wrapperEl.hasClass(me.options.roomStateColorClass.reservation)){me.selectingNewRangeOn=false;alert("Next day bed not free or temporary reservation")}});cellRooms.on("mouseenter.roomCalendarCell",function(){var roomNumberEl=$(this),roomCellDate=roomNumberEl.find("div.rc-body-cell").data("date");if(true===me.selectingNewRangeOn){if(roomNumberEl.hasClass("hover-calendar-cell")||roomNumberEl.hasClass(me.options.roomStateColorClass.busy)||roomNumberEl.hasClass(me.options.roomStateColorClass.partPayed)||roomNumberEl.hasClass(me.options.roomStateColorClass.reservation)){me.selectingNewRangeOn=false;cellRooms.removeClass("hover-calendar-cell-temp");for(var i=0;i<me.multipleSelectionElement.dateRange.length;i++){var cellForSelecting=me.multipleSelectionElement.parentRow.find('div[data-date="'+me.multipleSelectionElement.dateRange[i]+'"]');cellForSelecting.parent("td.rc-body-room-td").addClass("hover-calendar-cell")}me.rangesForNewOrder[me.rangesForNewOrder.length]={dateRange:me.multipleSelectionElement.dateRange,roomBed:me.multipleSelectionElement.roomBed,bedPricePerDay:me.multipleSelectionElement.bedPricePerDay,bedPricePerMonth:me.multipleSelectionElement.bedPricePerMonth,bedId:me.multipleSelectionElement.bedId,roomId:me.multipleSelectionElement.roomId};me.selectingNewRangeOn=false;alert("Next day bed not free or temporary reservation")}else{var startDate=moment(me.multipleSelectionElement.date,"YYYY-MM-DD"),currentDate=moment(roomCellDate,"YYYY-MM-DD"),duration=currentDate.diff(startDate,"days");if(duration<0){var temp=startDate;startDate=currentDate;currentDate=temp}var dateRangeCreate=false,daysSelectingInterval=[],ind=0;while(false===dateRangeCreate){daysSelectingInterval[ind]=startDate.format("YYYY-MM-DD");var durationR=currentDate.diff(startDate,"days");if(durationR<=0){dateRangeCreate=true}else{startDate.add(1,"days")}ind++}me.multipleSelectionElement.dateRange=daysSelectingInterval;cellRooms.removeClass("hover-calendar-cell-temp");for(var i=0;i<daysSelectingInterval.length;i++){var cellForSelecting=me.multipleSelectionElement.parentRow.find('div[data-date="'+daysSelectingInterval[i]+'"]');cellForSelecting.parent("td.rc-body-room-td").addClass("hover-calendar-cell-temp")}}}});cellRooms.on("mouseup.roomCalendarCell",function(){if(true===me.selectingNewRangeOn){cellRooms.removeClass("hover-calendar-cell-temp");for(var i=0;i<me.multipleSelectionElement.dateRange.length;i++){var cellForSelecting=me.multipleSelectionElement.parentRow.find('div[data-date="'+me.multipleSelectionElement.dateRange[i]+'"]');cellForSelecting.parent("td.rc-body-room-td").addClass("hover-calendar-cell")}me.rangesForNewOrder[me.rangesForNewOrder.length]={dateRange:me.multipleSelectionElement.dateRange,roomBed:me.multipleSelectionElement.roomBed,bedPricePerDay:me.multipleSelectionElement.bedPricePerDay,bedPricePerMonth:me.multipleSelectionElement.bedPricePerMonth,bedId:me.multipleSelectionElement.bedId,roomId:me.multipleSelectionElement.roomId};me.selectingNewRangeOn=false}});toolbar.find("#rc_confirm_ok").on("click",function(){var combinetedIntervals=[],ind=0,findInterval=false;cellRooms.each(function(){var element=$(this);if(element.hasClass("hover-calendar-cell")){var bedData=element.find(".rc-body-cell"),date=bedData.data("date"),roomBed=bedData.data("room"),bedPricePerDay=parseInt(bedData.data("bed-price-per-day")),bedPricePerMonth=parseInt(bedData.data("bed-price-per-month")),bedId=parseInt(bedData.data("bed-id")),roomId=parseInt(bedData.data("bed-room-id")),bedLocationId=parseInt(bedData.data("location-id")),bedLocationText=bedData.data("location-text");if(true===findInterval){if(combinetedIntervals[ind].roomBed===roomBed){combinetedIntervals[ind].dateRange[combinetedIntervals[ind].dateRange.length]=date}else{var lastIntervalDay=combinetedIntervals[ind].dateRange[combinetedIntervals[ind].dateRange.length-1],nextDayForInterval=moment(lastIntervalDay).add(1,"days");combinetedIntervals[ind].dateRange[combinetedIntervals[ind].dateRange.length]=nextDayForInterval.format("YYYY-MM-DD");ind++;combinetedIntervals[ind]={dateRange:[date],roomBed:roomBed,bedPricePerDay:bedPricePerDay,bedPricePerMonth:bedPricePerMonth,bedId:bedId,roomId:roomId,locationId:bedLocationId,locationText:bedLocationText};findInterval=true}}else{combinetedIntervals[ind]={dateRange:[date],roomBed:roomBed,bedPricePerDay:bedPricePerDay,bedPricePerMonth:bedPricePerMonth,bedId:bedId,roomId:roomId,locationId:bedLocationId,locationText:bedLocationText};findInterval=true}}else if(!element.hasClass("hover-calendar-cell")&&true===findInterval){var lastIntervalDay=combinetedIntervals[ind].dateRange[combinetedIntervals[ind].dateRange.length-1],nextDayForInterval=moment(lastIntervalDay).add(1,"days");combinetedIntervals[ind].dateRange[combinetedIntervals[ind].dateRange.length]=nextDayForInterval.format("YYYY-MM-DD");findInterval=false;ind++}});toolbarBox.hide(300);cellRooms.removeClass("hover-calendar-cell");calendarContainer.trigger($.Event("rc-multiple-selection"),{data:combinetedIntervals})});toolbar.find("#rc_confirm_cancel").on("click",function(){toolbarBox.hide(300);me.rangesForNewOrder=[];me.multipleSelectionElement=[];cellRooms.removeClass("hover-calendar-cell")})},renderTableData:function(items){var me=this,rangeDates=me.rangeDates,tableHeader=$(".rc-calendar-header"),tableBody=$(".rc-calendar-body"),cellRooms=$(".rc-table tbody > tr > td.rc-body-room-td"),toolbar=$(".rc-bottom-toolbar .rc-confirm-block");var headHtml='<th colspan="2"><div class="rc-header-cell">Room/bad</div></th>';headHtml+=me.renderHeaderDateColumn(rangeDates);tableHeader.empty();tableHeader.append(headHtml);var itemList=items||me.items;var bodyHtml=me.renderRooms(itemList,rangeDates);cellRooms.unbind(".roomCalendarCell");tableBody.empty();tableBody.append(bodyHtml);cellRooms=$(".rc-table tbody > tr > td.rc-body-room-td");me.setEventCellRoms(cellRooms,itemList,toolbar)},newDateRange:function(direction){var me=this,startDate="";switch(direction){case"prev":startDate=moment(me.rangeDates[0]).subtract(me.options.countShowDay,"days").format("YYYY-MM-DD");break;case"next":var lastEl=me.rangeDates.length-1;startDate=me.rangeDates[lastEl];break}me.rangeDates=me.getRangeDate(startDate,me.options.countShowDay);if(me.options.sourceConfig.actionUrl===""){me.renderTableData()}else{me.getSourceData("btn_navig")}},applyLocationFilter:function(){var me=this;if(me.options.sourceConfig.actionUrl!==""){me.getSourceData("filter_location")}},applyRangeFilter:function(){var me=this,newRange=[];if(me.filters.range.start!==""&&me.filters.range.end!==""){var startM=moment(me.filters.range.start),endM=moment(me.filters.range.end),duration=endM.diff(startM,"days");if(duration>=0){duration+=1}else if(duration<0){alert("Start date must be less than End date!")}if(duration>0){var newRange=me.getRangeDate(me.filters.range.start,duration);me.options.countShowDay=duration;me.rangeDates=newRange;me.getSourceData("filter_range")}}else{alert("Dates are not chosen.")}},renderHeaderDateColumn:function(rangeDates){var dateHeaderHtml="";if(rangeDates.length>0){$.each(rangeDates,function(ind,elem){dateHeaderHtml+='<th><div class="rc-header-cell">'+moment(elem).format("MM/DD")+"</div></th>"})}else{dateHeaderHtml="<th>Dates not found!</th>"}return dateHeaderHtml},renderRooms:function(items,rangeDates){var roomRowsHtml="",me=this;if(false===me.allLocation){if(items.length>0){if(rangeDates.length>0){$.each(items,function(indG,elemG){var itemsG=elemG.group_data,titleG=elemG.group_name;$.each(itemsG,function(ind,elem){if(ind===0){roomRowsHtml+='<tr><td class="rc-body-room-title-cell" rowspan="'+itemsG.length+'"><span class="rc-rotated-text"><span class="rc-rotated-text__inner">'+titleG+"</span></span></td>"+me.renderRowRoom(elem,rangeDates)+"</tr>"}else{roomRowsHtml+="<tr>"+me.renderRowRoom(elem,rangeDates)+"</tr>"}})})}}else{roomRowsHtml="<tr><td>Rooms data empty</td></tr>"}}else{var locationCount=items.length;if(locationCount>0){var colspanRow=parseInt(me.options.countShowDay)+2;for(var i=0;i<locationCount;i++){roomRowsHtml+='<tr><td class="rc-header-all-location text-danger" colspan="'+colspanRow+'">'+items[i].location+"</td></tr>";if(items[i].rooms_reservation.length>0){if(rangeDates.length>0){$.each(items[i].rooms_reservation,function(indG,elemG){var itemsG=elemG.group_data,titleG=elemG.group_name;$.each(itemsG,function(ind,elem){if(ind===0){roomRowsHtml+='<tr data-location="'+items[i].location+'"><td class="rc-body-room-title-cell" rowspan="'+itemsG.length+'"><span class="rc-rotated-text"><span class="rc-rotated-text__inner">'+titleG+"</span></span></td>"+me.renderRowRoom(elem,rangeDates)+"</tr>"}else{roomRowsHtml+='<tr data-location="'+items[i].location+'">'+me.renderRowRoom(elem,rangeDates)+"</tr>"}})})}}else{roomRowsHtml+="<tr><td>Rooms data empty</td></tr>"}}}else{roomRowsHtml="<tr><td>Rooms data empty</td></tr>"}}return roomRowsHtml},renderRowRoom:function(roomData,rangeDates,groupTitle,countItem){var roomType=roomData.roomType,groupTitle=groupTitle||"",countItem=countItem||0,me=this,roomRowHtml='<td class="'+(roomType==="M"?me.options.roomTypeColor.male:me.options.roomTypeColor.female)+' not-select-text">'+'<div class="rc-body-cell">'+roomData.roomName+"</div>"+"</td>";$.each(rangeDates,function(ind,elem){roomRowHtml+=me.renderRoomCell(roomData,elem)});return roomRowHtml},renderRoomCell:function(roomData,currentDay){var cellHtml="";var cellClassState=this.getCellClassColor(roomData,currentDay);cellHtml='<td class="rc-body-room-td '+cellClassState.color+'">'+'<div class="rc-body-cell'+(cellClassState.color===""||cellClassState.color===this.options.roomStateColorClass.free?" free-room-day":"")+'" data-room="'+roomData.roomName+'" data-date="'+currentDay+'" data-bed-price-per-day="'+roomData.roomData.bed.price_per_day+'" data-bed-price-per-month="'+roomData.roomData.bed.price_per_month+'" data-location-id="'+roomData.roomData.room.location_id+'" data-location-text="'+roomData.roomData.room.location+'" data-bed-id="'+roomData.roomData.bed.id+'" data-bed-room-id="'+roomData.roomData.room.id+'">'+(cellClassState.color!==""&&cellClassState.color!==this.options.roomStateColorClass.free?"$"+cellClassState.sumCell:"")+"</div>"+"</td>";return cellHtml},getCellClassColor:function(roomData,currentDay){var colorFind=false,busyDate=roomData.roomData.busy,reservationDate=roomData.roomData.reservation,partPayedDate=roomData.roomData.part_payed,colorClass="",clientFLN="",sum=0,me=this;if(busyDate.range.length>0){var isBusy=false;isBusy=me.findReservationDayRangeData(currentDay,busyDate.range);if(true===isBusy.found){colorClass=this.options.roomStateColorClass.busy;colorFind=true;clientFLN=isBusy.client;sum=isBusy.sum}}if(reservationDate.range.length>0&&false===colorFind){var isReservation=false;isReservation=me.findReservationDayRangeData(currentDay,reservationDate.range);if(true===isReservation.found){colorClass=this.options.roomStateColorClass.reservation;colorFind=true;clientFLN=isReservation.client;sum=isReservation.sum}}if(partPayedDate.range.length>0&&false===colorFind){var isPartPayedDate=false;isPartPayedDate=me.findReservationDayRangeData(currentDay,partPayedDate.range);if(true===isPartPayedDate.found){colorClass=this.options.roomStateColorClass.partPayed;colorFind=true;clientFLN=isPartPayedDate.client;sum=isPartPayedDate.sum}}if(false===colorFind){colorClass=this.options.roomStateColorClass.free}return{color:colorClass,clientFLN:clientFLN,sumCell:sum}},getRangeFilterBlock:function(){var renderHtml='<div class="row rc-range-filter-block">';renderHtml+='<div class="col-lg-5 col-md-5">'+'<input type="text" value="" placeholder="Start" id="rc-range-filter-start" class="form-control">'+"</div>"+'<div class="col-lg-5 col-md-5">'+'<input type="text" value="" placeholder="End" id="rc-range-filter-end" class="form-control">'+"</div>"+'<div class="col-lg-2 col-md-2"><button class="btn btn-default" id="rc-range-filter-submit">Ok</button></div>';renderHtml+="</div>";return renderHtml},findReservationDayRangeData:function(currentDay,range){var dayData={found:false,client:"",sum:0,order:{},check_in:"-",check_out:"-"},key;for(key in range){if(range[key].day===currentDay){dayData.found=true;dayData.client=range[key].client;dayData.sum=range[key].sum;dayData.check_in=range[key].check_in;dayData.check_out=range[key].check_out;dayData.order=range[key].order;break}}return dayData},getRangeDate:function(startDate,countShowDay){var rangeDate=[],startDateMoment=moment(startDate),nextDate;if(countShowDay>0){rangeDate[0]=startDateMoment.format("YYYY-MM-DD");for(var i=1;i<countShowDay;i++){nextDate=startDateMoment.add(1,"days");rangeDate[i]=nextDate.format("YYYY-MM-DD")}}return rangeDate},findRoomData:function(roomNumber,items,locationRow){var findRoomData={},notfind=true,locationRow=locationRow||"",me=this;if(false===me.allLocation){if(items.length>0){for(var i=0;i<items.length;i++){if(false===notfind){break}for(var k=0;k<items[i].group_data.length;k++){if(items[i].group_data[k].roomName===roomNumber){findRoomData=items[i].group_data[k];notfind=false;break}}}}}else{var locationCount=items.length;if(locationCount>0){for(var j=0;j<locationCount;j++){if(false===notfind){break}if(items[j].rooms_reservation.length>0){for(var i=0;i<items[j].rooms_reservation.length;i++){if(false===notfind){break}for(var k=0;k<items[j].rooms_reservation[i].group_data.length;k++){if(items[j].rooms_reservation[i].group_data[k].roomName===roomNumber&&items[j].location===locationRow){findRoomData=items[j].rooms_reservation[i].group_data[k];notfind=false;break}}}}}}}return findRoomData},getSourceData:function(action){var me=this,action=action||"init",rangeDates=me.rangeDates,loaderImg=$(".rc-ajax-loader"),lastRange=rangeDates.length-1,data={rangeStart:rangeDates[0],rangeEnd:rangeDates[lastRange],location:me.filters.location};if(loaderImg.length===0){me.container.append('<div class="rc-ajax-loader"><img src="'+me.options.loaderImg+'"></div>');loaderImg=$(".rc-ajax-loader")}else{loaderImg.show()}$.ajax({type:"POST",url:me.options.sourceConfig.actionUrl,data:data,success:function(data,status){if(status==="success"){if(data.status==="success"){loaderImg.hide();me.items=data.rooms_reservation;me.allLocation=data.all_location;me.container.trigger($.Event("rc-datareceived"),{showDays:me.options.countShowDay});switch(action){case"init":me.renderCalendarTable();break;case"btn_navig":me.renderTableData();break;case"filter_location":me.renderTableData();break;case"filter_range":me.renderTableData();break}}else{window.location.href=data.redirect_error}}},dataType:me.options.sourceConfig.dataType})},createSelectOption:function(items){var renderHtml="";if(items.length>0){$.each(items,function(){renderHtml+='<option value="'+this.id+'" '+(true===this.selected?'selected="selected"':"")+">"+this.title+"</option>"})}return renderHtml},getCalendarItems:function(){return this.items},isShowAllLocation:function(){return true===this.allLocation?1:0},clearMultipleSelectionData:function(){this.multipleSelectionElement={};this.selectingNewRangeOn=false;this.rangesForNewOrder=[];return true}};var methods={init:function(params){var options=$.extend({},defaults,params);RC.options=options;RC.initCalendar($(this),options);return this},getItems:function(){return RC.getCalendarItems()},isShowAllLocation:function(){return RC.isShowAllLocation()},clearMultipleSelectionData:function(){return RC.clearMultipleSelectionData()},renderItems:function(){RC.renderCalendarItems()}};$.fn.roomCalendar=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error('Method "'+method+'" not find in plugin jQuery.roomCalendar')}}})(jQuery,moment);